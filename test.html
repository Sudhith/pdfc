<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY DOC TOOLS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { margin: 20px; }
        .tab-content { margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center mb-4">MY DOC TOOLS</h1>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#pdf" type="button">PDF</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#word" type="button">Word</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ppt" type="button">PPT</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#image" type="button">Image</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="pdf" role="tabpanel">
            <h3 class="mt-3">Merge PDFs</h3>
            <form class="ajax-form" action="/merge" enctype="multipart/form-data">
                <input type="file" name="files" accept="application/pdf" multiple required>
                <button class="btn btn-success">Merge PDFs</button>
            </form>

            <hr>

            <h3>Split PDF</h3>
            <form class="ajax-form" action="/split" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required><br>
                Start: <input type="number" name="start" required> End: <input type="number" name="end" required><br>
                <button class="btn btn-success">Split PDF</button>
            </form>

            <hr>

            <h3>PDF → Word</h3>
            <form class="ajax-form" action="/pdf-to-word" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                <button class="btn btn-success">Convert</button>
            </form>

            <hr>

            <h3>Add Password</h3>
            <form class="ajax-form" action="/add-password" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                Password: <input type="text" name="password" required>
                <button class="btn btn-success">Protect PDF</button>
            </form>

            <hr>

            <h3>Unlock PDF</h3>
            <form class="ajax-form" action="/unlock" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                Password: <input type="text" name="password" required>
                <button class="btn btn-success">Unlock PDF</button>
            </form>

            <hr>
            <h3 class="mt-3">Extract Text from PDF</h3>
            <form class="ajax-form" action="/extract-text" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                <button class="btn btn-primary">Extract Text</button>
            </form>

            <hr>
            <h3 class="mt-3">PDF → Images (ZIP)</h3>
            <form class="ajax-form" action="/pdf-to-images" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                DPI: <input type="number" name="dpi" value="200" min="72" max="600">
                <button class="btn btn-primary">Convert to Images</button>
            </form>

            <hr>
            <h3 class="mt-3">Rotate PDF Pages</h3>
            <form class="ajax-form" action="/rotate" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                Angle: <select name="angle">
                    <option value="90">90°</option>
                    <option value="180">180°</option>
                    <option value="270">270°</option>
                </select>
                <button class="btn btn-primary">Rotate</button>
            </form>

            <hr>
            <h3 class="mt-3">PDF Metadata</h3>
            <form class="ajax-form" action="/metadata" enctype="multipart/form-data">
                <input type="file" name="file" accept="application/pdf" required>
                <button class="btn btn-secondary">Show Metadata</button>
            </form>

            <!-- simple result area for JSON/text responses -->
            <div id="tool-result" class="mt-3"></div>
        </div>

        <div class="tab-pane fade" id="word" role="tabpanel">
            <h3 class="mt-3">Word → PDF</h3>
            <form class="ajax-form" action="/word-to-pdf" enctype="multipart/form-data">
                <input type="file" name="file" accept=".docx" required>
                <button class="btn btn-success">Convert</button>
            </form>
        </div>

        <div class="tab-pane fade" id="ppt" role="tabpanel">
            <h3 class="mt-3">PPT → PDF</h3>
            <form class="ajax-form" action="/ppt-to-pdf" enctype="multipart/form-data">
                <input type="file" name="file" accept=".ppt,.pptx" required>
                <button class="btn btn-success">Convert</button>
            </form>
        </div>

        <div class="tab-pane fade" id="image" role="tabpanel">
            <h3 class="mt-3">Images → PDF</h3>
            <form class="ajax-form" action="/images-to-pdf" enctype="multipart/form-data">
                <input type="file" name="files" accept="image/*" multiple required>
                <button class="btn btn-success">Convert</button>
            </form>

            <hr>

            <h3>Resize & Compress Images</h3>
            <form class="ajax-form" action="/resize-compress-image" enctype="multipart/form-data">
                <input type="file" name="files" accept="image/*" multiple required><br>
                Width: <input type="number" name="width" required>
                Height: <input type="number" name="height" required>
                Quality: <input type="number" name="quality" value="85"><br>
                <button class="btn btn-success">Resize & Compress</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // AJAX for all forms
    document.querySelectorAll('.ajax-form').forEach(form => {
        form.addEventListener('submit', async e => {
            e.preventDefault();
            const endpoint = form.action;
            const formData = new FormData(form);
            const submitBtn = form.querySelector('button[type="submit"], button');

            // disable button while processing
            const prevText = submitBtn.innerText;
            submitBtn.disabled = true;
            submitBtn.innerText = "Processing...";

            // Optional: File size check (10MB)
            for (const file of formData.getAll('files')) {
                if (file && file.size > 50 * 1024 * 1024) { alert("File too large! (50MB limit)"); submitBtn.disabled=false; submitBtn.innerText=prevText; return; }
            }
            if (formData.has('file')) {
                const f = formData.get('file');
                if (f && f.size > 50 * 1024 * 1024) { alert("File too large! (50MB limit)"); submitBtn.disabled=false; submitBtn.innerText=prevText; return; }
            }

            try {
                const res = await fetch(endpoint, { method: 'POST', body: formData });
                const contentType = res.headers.get("Content-Type") || "";

                if (!res.ok) {
                    const err = await (contentType.includes("application/json") ? res.json() : res.text().then(t=>({error:t}))).catch(()=>({error:res.statusText}));
                    alert("Error: " + (err.error || JSON.stringify(err)));
                    submitBtn.disabled = false;
                    submitBtn.innerText = prevText;
                    return;
                }

                // If JSON (metadata), show in result area
                if (contentType.includes("application/json")) {
                    const json = await res.json();
                    const out = document.getElementById("tool-result");
                    out.innerHTML = "<pre>" + JSON.stringify(json, null, 2) + "</pre>";
                    submitBtn.disabled = false;
                    submitBtn.innerText = prevText;
                    return;
                }

                // If text (extracted text), open in new tab for reading
                if (contentType.startsWith("text/") ) {
                    const txt = await res.text();
                    const blob = new Blob([txt], {type: "text/plain"});
                    const url = URL.createObjectURL(blob);
                    window.open(url, "_blank");
                    submitBtn.disabled = false;
                    submitBtn.innerText = prevText;
                    return;
                }

                // Otherwise treat as binary file (zip/pdf/png) and download
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;

                const disposition = res.headers.get("Content-Disposition");
                let filename = "downloaded_file";
                if (disposition) {
                    const match = disposition.match(/filename="?(.+)"?/);
                    if (match && match[1]) filename = match[1];
                }
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                a.remove();

            } catch (err) {
                console.error("Fetch error:", err);
                if (err instanceof TypeError) {
                    alert("Network error: Failed to fetch. Check server status, CORS, or correct endpoint.");
                } else {
                    alert("Request failed: " + err);
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = prevText;
            }
        });
    });
</script>

</body>
</html>